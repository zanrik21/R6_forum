{% extends 'base.html' %}
{% block content %}

<div class="profile-wrapper">

    <!-- COVER / БАНЕР -->
    <div class="profile-cover">
        <div class="cover-overlay"></div>
        <div class="cover-content">
            <div class="cover-top-line">RAINBOW SIX SIEGE // OPERATOR CARD</div>
            <div class="cover-main-line">{{ profile_user.username }}</div>
            <div class="cover-bottom-line">

                {# Роль залежно від show_admin_status + is_staff/superuser #}
                {% if profile.show_admin_status and profile_user.is_superuser %}
                    <span class="role-badge role-admin">ADMIN</span>
                {% elif profile.show_admin_status and profile_user.is_staff %}
                    <span class="role-badge role-mod">MODERATOR</span>
                {% else %}
                    <span class="role-badge role-player">PLAYER</span>
                {% endif %}

                {# РАНГ З ПРОФІЛЮ #}
                {% if profile.rank == 'champion' %}
                    <span class="rank-badge rank-champ">CHAMPION</span>
                {% elif profile.rank == 'diamond' %}
                    <span class="rank-badge rank-diamond">DIAMOND</span>
                {% elif profile.rank == 'platinum' %}
                    <span class="rank-badge rank-plat">PLATINUM</span>
                {% elif profile.rank == 'gold' %}
                    <span class="rank-badge rank-gold">GOLD</span>
                {% elif profile.rank == 'silver' %}
                    <span class="rank-badge rank-silver">SILVER</span>
                {% else %}
                    <span class="rank-badge rank-bronze">BRONZE</span>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- КАРТКА ПРОФІЛЮ -->
    <div class="profile-card">
        <div class="avatar-wrapper">
            {% if profile.avatar %}
                <img src="{{ profile.avatar.url }}" alt="avatar" class="profile-avatar">
            {% else %}
                <div class="profile-avatar placeholder">
                    <span>{{ profile_user.username|first|upper }}</span>
                </div>
            {% endif %}

            {% if profile_user == user %}
                <span class="status-dot online" title="Online"></span>
            {% else %}
                <span class="status-dot offline" title="Offline"></span>
            {% endif %}
        </div>

        <div class="profile-info">
            <div class="profile-header-row">
                <h2 class="profile-name">{{ profile_user.username }}</h2>

                {% if profile_user == user %}
                    <a href="{% url 'profile_edit' %}" class="btn-edit">Редагувати</a>
                {% endif %}
            </div>

            <div class="profile-subrow">
                {% if profile_user == user %}
                    <span class="status-text online">● Online</span>
                {% else %}
                    <span class="status-text offline">● Offline</span>
                {% endif %}
            </div>

            <p class="profile-label">Bio</p>
            <p class="profile-bio">
                {{ profile.bio|default:"(порожньо)" }}
            </p>

            {% if ban and ban.is_active %}
                <p class="profile-banned">Користувач заблокований.</p>
            {% endif %}

            {% if user.is_staff and user != profile_user %}
                <div class="admin-actions">
                    {% if ban and ban.is_active %}
                        <form method="post" action="{% url 'unban_user' profile_user.id %}">
                            {% csrf_token %}
                            <button type="submit" class="btn-outline">Розбанити</button>
                        </form>
                    {% else %}
                        <form method="post" action="{% url 'ban_user' profile_user.id %}">
                            {% csrf_token %}
                            <button type="submit" class="btn-danger">Забанити</button>
                        </form>
                    {% endif %}
                </div>
            {% endif %}
        </div>
    </div>

    <!-- ОСТАННІ ТЕМИ -->
    <div class="card profile-subcard">
        <div class="card-header">
            <div class="card-title">Останні теми</div>
        </div>
        {% if last_topics %}
            <ul class="list">
                {% for t in last_topics %}
                    <li>
                        <a href="{% url 'topic_detail' t.pk %}">{{ t.title }}</a><br>
                        <span class="muted">
                            Категорія: {{ t.category.name }} · {{ t.created_at|date:"d.m.Y H:i" }}
                        </span>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="empty">Користувач ще не створював тем.</p>
        {% endif %}
    </div>

    <!-- ОСТАННІ ПОВІДОМЛЕННЯ -->
    <div class="card profile-subcard">
        <div class="card-header">
            <div class="card-title">Останні повідомлення</div>
        </div>
        {% if last_posts %}
            <ul class="list">
                {% for p in last_posts %}
                    <li>
                        <a href="{% url 'topic_detail' p.topic.pk %}">{{ p.topic.title }}</a><br>
                        <span class="muted">
                            {{ p.created_at|date:"d.m.Y H:i" }}
                        </span><br>
                        <span>{{ p.content|truncatechars:120 }}</span>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p class="empty">Користувач ще не залишав повідомлень.</p>
        {% endif %}
    </div>
</div>

<style>
/* ===== WRAPPER ===== */
.profile-wrapper {
    max-width: 900px;
    margin: 0 auto;
}

/* ===== COVER / БАНЕР ===== */
.profile-cover {
    position: relative;
    height: 160px;
    border-radius: 14px;
    overflow: hidden;
    margin-bottom: 22px;
    border: 1px solid #2a2f3d;
    background: linear-gradient(120deg, #111622, #1c2536, #18120a);
}

.cover-overlay {
    position: absolute;
    inset: 0;
    background-image:
        linear-gradient(135deg, rgba(0,0,0,0.4), rgba(0,0,0,0.1)),
        repeating-linear-gradient(
            -45deg,
            rgba(255,255,255,0.06),
            rgba(255,255,255,0.06) 1px,
            transparent 1px,
            transparent 4px
        );
    mix-blend-mode: soft-light;
}

.cover-content {
    position: relative;
    height: 100%;
    padding: 18px 26px;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    color: #f5f5f5;
}

.cover-top-line {
    font-size: 11px;
    letter-spacing: 0.18em;
    text-transform: uppercase;
    opacity: 0.7;
}

.cover-main-line {
    font-size: 28px;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 0.16em;
}

.cover-bottom-line {
    display: flex;
    gap: 8px;
}

/* ===== BADGES ===== */
.role-badge,
.rank-badge {
    font-size: 11px;
    text-transform: uppercase;
    padding: 3px 10px;
    border-radius: 999px;
    letter-spacing: 0.12em;
    border: 1px solid;
}

/* Ролі */
.role-admin {
    border-color: #ff6363;
    color: #ff9d9d;
    background: rgba(255,99,99,0.12);
}
.role-mod {
    border-color: #64b5ff;
    color: #b0d8ff;
    background: rgba(100,181,255,0.1);
}
.role-player {
    border-color: #8b92a0;
    color: #c5cad8;
    background: rgba(139,146,160,0.16);
}

/* Ранги */
.rank-champ {
    border-color: #ff9d40;
    color: #ffe3b4;
    background: rgba(255,157,64,0.12);
}
.rank-diamond {
    border-color: #64ffda;
    color: #c3fff1;
    background: rgba(100,255,218,0.15);
}
.rank-plat {
    border-color: #64c0ff;
    color: #c2e5ff;
    background: rgba(100,192,255,0.15);
}
.rank-gold {
    border-color: #ffdd55;
    color: #fff0ba;
    background: rgba(255,221,85,0.16);
}
.rank-silver {
    border-color: #b0bec5;
    color: #e3edf2;
    background: rgba(176,190,197,0.18);
}
.rank-bronze {
    border-color: #b9794a;
    color: #f2d0b6;
    background: rgba(185,121,74,0.16);
}

/* ===== CARD ===== */
.profile-card {
    display: flex;
    align-items: center;
    background: #0d0f16;
    border: 1px solid #2a2f3d;
    border-radius: 14px;
    padding: 22px 24px;
    gap: 26px;
    box-shadow: 0 14px 34px rgba(0,0,0,0.4);
    position: relative;
    margin-bottom: 18px;
}

.profile-subcard {
    margin-top: 14px;
}

/* ===== AVATAR ===== */
.avatar-wrapper {
    position: relative;
    flex-shrink: 0;
}

.profile-avatar {
    width: 130px;
    height: 130px;
    border-radius: 50%;
    border: 3px solid var(--accent);
    object-fit: cover;
    box-shadow: 0 0 20px rgba(255, 200, 70, 0.35);
    transition: 0.2s;
}

.profile-avatar:hover {
    transform: scale(1.03);
    box-shadow: 0 0 28px rgba(255, 200, 70, 0.55);
}

.profile-avatar.placeholder {
    display: flex;
    align-items: center;
    justify-content: center;
    background: #181b24;
    color: var(--accent);
    font-size: 52px;
    font-weight: 800;
}

/* STATUS DOT */
.status-dot {
    position: absolute;
    bottom: 6px;
    right: 6px;
    width: 16px;
    height: 16px;
    border-radius: 50%;
    border: 2px solid #05070b;
}
.status-dot.online {
    background: #38ff8b;
    box-shadow: 0 0 10px rgba(56,255,139,0.7);
}
.status-dot.offline {
    background: #888f9f;
    box-shadow: 0 0 4px rgba(136,143,159,0.6);
}

/* INFO */
.profile-info {
    flex: 1;
}

.profile-header-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 10px;
}

.profile-name {
    font-size: 22px;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--accent);
    margin-bottom: 4px;
}

.profile-subrow {
    margin-bottom: 10px;
}

.status-text {
    font-size: 13px;
}
.status-text.online {
    color: #38ff8b;
}
.status-text.offline {
    color: #888f9f;
}

.profile-label {
    margin-top: 8px;
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 0.12em;
    color: #8b92a0;
}

.profile-bio {
    margin-bottom: 12px;
    font-size: 14px;
}

.profile-banned {
    color: #ff4b4b;
    font-weight: 700;
    margin-bottom: 10px;
}

/* BUTTONS */
.btn-edit {
    display: inline-block;
    padding: 8px 16px;
    border-radius: 8px;
    background: var(--accent);
    color: #000;
    font-weight: 700;
    text-transform: uppercase;
    font-size: 12px;
    border: 1px solid var(--accent);
    letter-spacing: 0.08em;
}

.btn-edit:hover {
    background: #ffd873;
}

.admin-actions {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    margin-top: 6px;
}

.btn-danger {
    padding: 7px 14px;
    border-radius: 6px;
    border: 1px solid #ff4b4b;
    background: transparent;
    color: #ff4b4b;
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 0.06em;
}

.btn-outline {
    padding: 7px 14px;
    border-radius: 6px;
    border: 1px solid var(--accent);
    background: transparent;
    color: var(--accent);
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 0.06em;
}
</style>

{% endblock %}
